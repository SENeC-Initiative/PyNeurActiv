<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyneuractiv.models.fardet_2017_synchronous_bursting &#8212; PyNeurActiv 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/na_theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootswatch-3.3.6/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/nngt_ico.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="keywords" content="pyneuractiv, neuron, activity, neuronal, python, nest">
    <meta name="description" content="Documentation for the python module pyNeurActiv, which provides models to describe neuronal networks and analyze their activity.">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          PyNeurActiv</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../py-modindex.html">Modules</a></li>
                <li><a href="../../../genindex.html">Index</a></li>
                <li><a href="https://github.com/SENeC-Initiative/pyneuractiv">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to PyNeurActiv documentation!</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/analysis.html">Analysis module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/analysis.html#content">Content</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/io.html">Input/output module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/io.html#content">Content</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/lib.html">Lib module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/lib.html#content">Content</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/models.html">Models module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/models.html#content">Content</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Current <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for pyneuractiv.models.fardet_2017_synchronous_bursting</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot; Computing the theoretical properties of the bursting dynamics &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">add_metaclass</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">brentq</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="k">import</span> <span class="n">lambertw</span>

<span class="kn">from</span> <span class="nn">pyneuractiv.analysis</span> <span class="k">import</span> <span class="n">find_idx_nearest</span>
<span class="kn">import</span> <span class="nn">pyneuractiv.lib</span> <span class="k">as</span> <span class="nn">_plib</span>


<span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">_plib</span><span class="o">.</span><span class="n">ResNames</span><span class="p">)</span>
<div class="viewcode-block" id="Fardet2017_SynchroBurst"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst">[docs]</a><span class="k">class</span> <span class="nc">Fardet2017_SynchroBurst</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class computing the theoretical properties of the bursting dynamics for</span>
<span class="sd">    coupled aEIF neurons.</span>
<span class="sd">    Predictions are available for three different synaptic models: &quot;dirac&quot;,</span>
<span class="sd">    &quot;continuous&quot; or &quot;alpha&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">_res_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;burst_duration&#39;</span><span class="p">,</span> <span class="s1">&#39;IBI&#39;</span><span class="p">,</span> <span class="s1">&#39;ISI&#39;</span><span class="p">,</span> <span class="s1">&#39;w_min&#39;</span><span class="p">,</span> <span class="s1">&#39;w_max&#39;</span><span class="p">,</span> <span class="s1">&#39;V_min&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SpB&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Fardet2017_SynchroBurst.help"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Help for `Fardet2017_SynchroBurst` model</span>
<span class="s1">----------------------------------------</span>

<span class="s1">Initialization with a dictionary containing the usual entries for a NEST</span>
<span class="s1">&quot;aeif_cond_alpha&quot; model, as well as 4 additional entries (&quot;model&quot;, &quot;weight&quot;,</span>
<span class="s1">&quot;avg_deg&quot;, and &quot;delay&quot; -- see ``__init__`` docstring for details).</span>

<span class="s1">Ex: ``theo = Fardet2017_SynchroBurst(di_param)``</span>


<span class="s1">Goal</span>
<span class="s1">----</span>

<span class="s1">Compute the properties of the bursting dynamics of coupled aEIF neurons for</span>
<span class="s1">various synaptic models (&quot;dirac&quot;, &quot;continuous&quot; or &quot;alpha&quot;).</span>


<span class="s1">Relevant functions</span>
<span class="s1">------------------</span>

<span class="s1">* ``theo.compute_properties(model=model_of_choice)``: compute all relevant</span>
<span class="s1">    properties of the bursting dynamics</span>
<span class="s1">* ``theo.plot_time_evol(model=model_of_choice)``: plot the time evolution of</span>
<span class="s1">    the model.</span>


<span class="s1">* ``theo.w_max(model=model_of_choice)``: use a self-coherent equation to</span>
<span class="s1">    compute the maximal value of the adaptation variable `w` at the end of a</span>
<span class="s1">    burst.</span>
<span class="s1">* ``theo.IBI(w_max)``: computes the interburst interval for a given `w_max`. If</span>
<span class="s1">    no `w_max` is given, a &quot;model&quot; can be provided to compute it automatically,</span>
<span class="s1">    using ``theo.IBI(model=model_of_choice)``.</span>
<span class="s1">* ``theo.T_spike(w, model=model_of_choice)``: function computing the interspike</span>
<span class="s1">    for a given value of `w`. Depending on the model, additional parameters</span>
<span class="s1">    might be provided, see doctrings.</span>
<span class="s1">* ``theo.burst_duration(model=model_of_choice)``: returns burst duration</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Fardet2017_SynchroBurst.from_nest_network"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.from_nest_network">[docs]</a>    <span class="k">def</span> <span class="nf">from_nest_network</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">gids</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate the theoretical values computed from neurons in a network</span>
<span class="sd">        generated by NEST.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gids : tuple</span>
<span class="sd">            Indices of the neurons in NEST.</span>
<span class="sd">        ignore_errors : bool, optional (default: False)</span>
<span class="sd">            Returns NaN without raising an error if the parameters do not lead</span>
<span class="sd">            to synchronous bursting.</span>
<span class="sd">        verbose : bool, optional (default: True)</span>
<span class="sd">            Hide warnings if ``False``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instance of :class:`Fardet2017_SynchroBurst``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">nest</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">))</span>
        <span class="n">di_status</span> <span class="o">=</span> <span class="n">nest</span><span class="o">.</span><span class="n">GetStatus</span><span class="p">([</span><span class="n">gids</span><span class="p">[</span><span class="mi">0</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">nest</span><span class="o">.</span><span class="n">GetConnections</span><span class="p">(</span><span class="n">gids</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No connections in the network.&quot;</span><span class="p">)</span>
        <span class="n">di_status</span><span class="p">[</span><span class="s2">&quot;avg_deg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">connections</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">di_status</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nest</span><span class="o">.</span><span class="n">GetStatus</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">di_status</span><span class="p">[</span><span class="s2">&quot;delay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nest</span><span class="o">.</span><span class="n">GetStatus</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">di_status</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Init and compute</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prepare all the dimensionless values from the dictionnary `parameters`</span>
<span class="sd">        containing the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameters : dict</span>
<span class="sd">            Dictionary containing the parameters for a model of type aEIF, as</span>
<span class="sd">            defined in the NEST simulator.</span>
<span class="sd">        ignore_errors : bool, optional (default: False)</span>
<span class="sd">            Returns NaN without raising an error if the parameters do not lead</span>
<span class="sd">            to synchronous bursting.</span>
<span class="sd">        verbose : bool, optional (default: True)</span>
<span class="sd">            Hide warnings if ``False``.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        `parameters` must contain:</span>

<span class="sd">        * all neuronal parameters for the NEST aeif model</span>
<span class="sd">        * a ``&quot;model&quot;`` entry with model name in NEST, e.g. &quot;aeif_psc_alpha&quot;</span>
<span class="sd">        * a ``&quot;weight&quot;`` entry giving the synaptic strength in pA</span>
<span class="sd">        * an ``&quot;avg_deg&quot;`` entry giving average number of neighbours</span>
<span class="sd">        * a ``&quot;delay&quot;`` entry giving the synaptic delay</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="s2">&quot;tau_m&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;tau_m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;C_m&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;tau_m&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;V_th&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">]</span>
        <span class="n">dimensionless_prop</span> <span class="o">=</span> <span class="n">_plib</span><span class="o">.</span><span class="n">adim_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adim_params</span> <span class="o">=</span> <span class="n">dimensionless_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_values</span><span class="p">(</span><span class="n">dimensionless_prop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="p">:</span> <span class="mf">0.</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">result_names</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TheoResults</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TheoResults&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="c1"># values containing informations about the object state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span> <span class="o">=</span> <span class="n">ignore_errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Main functions</span>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.compute_properties"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.compute_properties">[docs]</a>    <span class="k">def</span> <span class="nf">compute_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute the following properties of the bursting dynamics:</span>

<span class="sd">        * &quot;w_max&quot; (maximum value of `w` at the end of a burst)</span>
<span class="sd">        * &quot;w_min&quot; (minimal value of `w` juste before a burst starts)</span>
<span class="sd">        * &quot;SpB&quot; (spikes per burst, number of spikes in a burst)</span>
<span class="sd">        * &quot;ISI&quot; (interspike interval inside the burst)</span>
<span class="sd">        * &quot;burst_duration&quot; (burst duration)</span>
<span class="sd">        * &quot;IBI&quot; (inter-burst interval)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Synaptic model to use.</span>
<span class="sd">        adim : bool, optional (default: False)</span>
<span class="sd">            Whether the results should be dimensionless or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`collections.namedtuple` containing the aforementionned values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;w_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_min</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">w_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="n">w_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="n">V_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_end_burst</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;w_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;V_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;SpB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SpB</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_max</span> <span class="o">-</span> <span class="n">w_min</span><span class="p">)</span> <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;ISI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_ISI</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;burst_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">burst_duration</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;IBI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IBI</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># check for NaNs</span>
        <span class="n">contains_NaN</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">contains_NaN</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">else</span> <span class="n">contains_NaN</span>
        <span class="k">if</span> <span class="n">contains_NaN</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_dim</span> <span class="o">=</span> <span class="n">_plib</span><span class="o">.</span><span class="n">redim_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TheoResults</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TheoResults</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_res_dim</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.results"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a namedtuple with the computed results &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TheoResults</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TheoResults</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_res_dim</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.set_properties"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.set_properties">[docs]</a>    <span class="k">def</span> <span class="nf">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Change the values of the properties.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dic : dict</span>
<span class="sd">            Dictionnary containing NEST-formatted properties for the aEIF model</span>
<span class="sd">            and/or one of the following entries: &quot;weight&quot;, &quot;avg_deg&quot;, &quot;delay&quot;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">,</span> <span class="s2">&quot;Invalid key </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;tau_m&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;C_m&quot;</span> <span class="ow">in</span> <span class="n">dic</span> <span class="ow">and</span> <span class="s2">&quot;g_L&quot;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;tau_m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;C_m&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;C_m&quot;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;tau_m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;C_m&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;g_L&quot;</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;tau_m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;C_m&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dic</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;tau_m&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;V_th&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">]</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;aeif&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Model should be of type &#39;aeif_*&#39; neurons.&quot;</span><span class="p">)</span>
        <span class="n">dimensionless_prop</span> <span class="o">=</span> <span class="n">_plib</span><span class="o">.</span><span class="n">adim_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adim_params</span> <span class="o">=</span> <span class="n">dimensionless_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_values</span><span class="p">(</span><span class="n">dimensionless_prop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.time_evolution"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.time_evolution">[docs]</a>    <span class="k">def</span> <span class="nf">time_evolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">num_bursts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                       <span class="n">homogeneous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the time evolution of the V and w variables for the theoretical</span>
<span class="sd">        mean-field model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Synaptic model, among &quot;dirac&quot;, &quot;continuous&quot; and &quot;alpha&quot;.</span>
<span class="sd">        num_bursts : int, optional (default: 3)</span>
<span class="sd">            Number of bursts to model.</span>
<span class="sd">        steps int, optional (default: 1000)</span>
<span class="sd">            Number of steps taken to model each time interval (initial decrease</span>
<span class="sd">            of V, recovery period and bursting period; default is 1000).</span>
<span class="sd">        homogeneous : bool, optional (default: False)</span>
<span class="sd">            Whether the network is considered homogeneous (fixed-in-degree), in</span>
<span class="sd">            which case $w$ is incremented in successive steps of $b$ until</span>
<span class="sd">            $w_{max} &gt; w^*$, or heterogeneous, in which case $w$ increases</span>
<span class="sd">            smoothly up to $w^*$.</span>
<span class="sd">        adim : bool, optional (default: False)</span>
<span class="sd">            Whether the variables should be given in dimensionless units.</span>
<span class="sd">        show : bool, optional (default: True)</span>
<span class="sd">            Whether the results should be displayed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts, Vs, ws, stimes : :class:`numpy.array` objects</span>
<span class="sd">            time, voltage, and adaptation variables, as well as the spike</span>
<span class="sd">            times.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">Vs_tmp</span><span class="p">,</span> <span class="n">ws_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">ts</span><span class="p">,</span> <span class="n">Vs</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">stimes</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="c1"># w &amp; V critical values</span>
        <span class="n">w_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">homogeneous</span><span class="o">=</span><span class="n">homogeneous</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="n">V_max</span><span class="p">,</span> <span class="n">t_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_end_burst</span><span class="p">(</span>
            <span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">return_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bursts</span><span class="p">):</span>
            <span class="c1"># V &amp; w down</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;dirac&quot;</span><span class="p">):</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">t_max</span><span class="p">,</span> <span class="n">t_max</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">Vs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_max</span><span class="p">)</span>
                <span class="n">ws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w_max</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ts_tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t_max</span>
            <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">Vs_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_Vdown</span><span class="p">(</span>
                <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ws_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_wdown</span><span class="p">(</span>
                <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">)</span>
            <span class="n">Vs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Vs_tmp</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ws_tmp</span><span class="p">)</span>
            <span class="c1"># recovery start</span>
            <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">ws_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_w_recover_start</span><span class="p">(</span>
                <span class="n">ws</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">Vs_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_V_recover_start</span><span class="p">(</span>
                <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">ws</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">)</span>
            <span class="n">Vs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Vs_tmp</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ws_tmp</span><span class="p">)</span>
            <span class="c1"># recovery</span>
            <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">ws_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_w_recover</span><span class="p">(</span>
                <span class="n">ws</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Vs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">ts_tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">Vs_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_V_recover</span><span class="p">(</span><span class="n">ws_tmp</span><span class="p">,</span> <span class="n">Vs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">)</span>
            <span class="n">Vs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Vs_tmp</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ws_tmp</span><span class="p">)</span>
            <span class="c1"># burst</span>
            <span class="n">ts_tmp</span><span class="p">,</span> <span class="n">ws_tmp</span><span class="p">,</span> <span class="n">st_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_w_burst</span><span class="p">(</span>
                <span class="n">ws</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">steps</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">homogeneous</span><span class="o">=</span><span class="n">homogeneous</span><span class="p">,</span>
                <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">stimes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">st_tmp</span> <span class="o">+</span> <span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">)</span>
            <span class="n">Vs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">)))</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ws_tmp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Time evolution&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">Vs</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">V_spike</span> <span class="o">=</span> <span class="p">(</span><span class="n">theo</span><span class="o">.</span><span class="n">Vp</span> <span class="o">/</span> <span class="mf">2.</span> <span class="k">if</span> <span class="n">adim</span>
                       <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;V_peak&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stimes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">V_spike</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stimes</span><span class="p">)),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                     <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$V$ (mV)&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$w$ (pA)&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (ms)&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Vs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stimes</span><span class="p">)</span></div>


    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Get characteristic values</span>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.w_max"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.w_max">[docs]</a>    <span class="k">def</span> <span class="nf">w_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">w_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">homogeneous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the critical value for w (at which the burst stops).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Name of the synaptic model that should be used, among &quot;dirac&quot;,</span>
<span class="sd">            &quot;continuous&quot;, and &quot;alpha&quot;.</span>
<span class="sd">        w_lim : double, optional (default: None)</span>
<span class="sd">            Higher limit for w_max when using the &quot;alpha&quot; model.</span>
<span class="sd">        homogeneous : bool, optional (default: False)</span>
<span class="sd">            Whether we should return the exact dynamics for a network of</span>
<span class="sd">            homogeneous neurons or a smoothed mean-field dynamics for a</span>
<span class="sd">            heterogeneous network.</span>
<span class="sd">        adim (bool, optional, default: True):</span>
<span class="sd">            Whether the results should be dimensionless or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w_max : double</span>
<span class="sd">            The maximum value of w at the end of a burst.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># check that the neurons are out of equilibrium</span>
        <span class="n">out_of_eq</span> <span class="o">=</span> <span class="n">_plib</span><span class="o">.</span><span class="n">out_of_eq_aeif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_adim_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_of_eq</span><span class="p">:</span>
            <span class="n">w_min</span><span class="p">,</span> <span class="n">sce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="kc">None</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">sce_alpha</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
                   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs_sce_alpha</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="n">w</span>
                <span class="n">sce</span> <span class="o">=</span> <span class="n">sce_alpha</span>
                <span class="n">w_lim</span> <span class="o">=</span> <span class="n">w_min</span> <span class="o">+</span> <span class="mi">30</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="k">if</span> <span class="n">w_lim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">w_lim</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">sce_continuous</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
                   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs_sce_continuous</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="n">w</span>
                <span class="n">sce</span> <span class="o">=</span> <span class="n">sce_continuous</span>
                <span class="n">w_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Imax</span> <span class="k">if</span> <span class="n">w_lim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">w_lim</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">sce_dirac</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
                   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs_sce_dirac</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="n">w</span>
                <span class="n">sce</span> <span class="o">=</span> <span class="n">sce_dirac</span>
                <span class="n">w_lim</span> <span class="o">=</span> <span class="n">w_min</span><span class="o">+</span><span class="mi">30</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="k">if</span> <span class="n">w_lim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">w_lim</span>
            <span class="c1"># compute and return</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">w_star</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">sce</span><span class="p">,</span> <span class="n">w_min</span><span class="p">,</span> <span class="n">w_lim</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
                   <span class="n">w_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameters lead to stable equilibrium.&quot;</span><span class="p">)</span>
        <span class="c1"># the value makes sense only if there are at least two spikes</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">w_star</span> <span class="o">-</span> <span class="n">w_min</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mf">2.</span><span class="p">:</span>
            <span class="n">w_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">if</span> <span class="n">homogeneous</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">w_min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">w_star</span><span class="o">-</span><span class="n">w_min</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)))</span><span class="o">*</span><span class="n">dim</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">w_star</span><span class="o">*</span><span class="n">dim</span></div>


<div class="viewcode-block" id="Fardet2017_SynchroBurst.ISI"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.ISI">[docs]</a>    <span class="k">def</span> <span class="nf">ISI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Inter-spike interval during the burst (time between two consecutive</span>
<span class="sd">        spikes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w : double</span>
<span class="sd">            Value of the adaptation variable.</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Synaptic model.</span>
<span class="sd">        I  : double, optional (default: None)</span>
<span class="sd">            Value of the input current (required for the continuous model</span>
<span class="sd">            only).</span>
<span class="sd">        adim : bool, optional (default: False)</span>
<span class="sd">            Whether the result is should be dimensionned or not.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="k">if</span> <span class="n">I</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">I</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interspike_alpha</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interspike_continuous_approx</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">adim</span><span class="p">)</span> <span class="k">if</span> <span class="n">approx</span>
                   <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">interspike_continuous</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">adim</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interspike_dirac</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fardet2017_SynchroBurst.IBI"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.IBI">[docs]</a>    <span class="k">def</span> <span class="nf">IBI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function returning the value of the interburst interval.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w_max  : double, optional (default: None)</span>
<span class="sd">            Maximum value of the adaptation variable at the end of the burst</span>
<span class="sd">            (given by  self-coherent equation). If ``None``, will be computed</span>
<span class="sd">            using the model given by the `model` parameter.</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Model to use in order to compute `w_max` if ``None`` is provided.</span>
<span class="sd">        adim : bool, optional (default: True)</span>
<span class="sd">            Whether the result return is dimensionless or not.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">w_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span><span class="p">:</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
                <span class="k">return</span> <span class="n">dim</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;IBI&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="c1"># First compute the time necessary for the sharp decrease of V</span>
        <span class="n">V_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_end_burst</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Tdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">V_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">Tdown</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">w_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">T_start_recov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_start_recover</span><span class="p">(</span><span class="n">V_min</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wmin0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>
        <span class="n">w_recov_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_recover_start</span><span class="p">(</span>
            <span class="n">T_start_recov</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Then compute the time necessary for `w` to decay to w_min</span>
        <span class="n">cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">arg_log</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_recov_start</span><span class="o">-</span><span class="n">cst</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">wmin</span><span class="o">+</span><span class="n">wmin0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="n">cst</span><span class="p">)</span>
        <span class="n">T_recov</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">arg_log</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="c1"># duration of the first spike</span>
        <span class="n">V_recov_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_recover_start</span><span class="p">(</span>
            <span class="n">T_start_recov</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">V_end_recov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_recover_lin</span><span class="p">(</span>
            <span class="n">wmin0</span><span class="p">,</span> <span class="n">w_recov_start</span><span class="p">,</span> <span class="n">wmin</span><span class="p">,</span> <span class="n">V_recov_start</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">T_fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_first_spike</span><span class="p">(</span><span class="n">V_end_recov</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># sum all</span>
        <span class="n">IBI</span> <span class="o">=</span> <span class="n">Tdown</span> <span class="o">+</span> <span class="n">T_recov</span> <span class="o">+</span> <span class="n">T_start_recov</span> <span class="o">+</span> <span class="n">T_fs</span>
        <span class="k">return</span> <span class="n">IBI</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">IBI</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>


<div class="viewcode-block" id="Fardet2017_SynchroBurst.w_minus"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.w_minus">[docs]</a>    <span class="k">def</span> <span class="nf">w_minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Minimum value reached by w just before burst initiation. &#39;&#39;&#39;</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w_min</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">w_min</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span></div>


<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_down"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_down">[docs]</a>    <span class="k">def</span> <span class="nf">V_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">Tdown</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Minimum value reached by V quickly after burst termination. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">V_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">Tdown</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Tdown</span><span class="p">)</span>
        <span class="n">Vmin0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_min0</span><span class="p">(</span><span class="n">w_max</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w_max</span>
        <span class="n">dotw0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">Vmin0</span> <span class="o">+</span> <span class="n">V_max</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span> <span class="o">-</span> <span class="n">w_max</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tw</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">V_max</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">dotw0</span>
        <span class="n">V_down</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">dotw0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span>
        <span class="k">return</span> <span class="n">V_down</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">V_down</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.SpB"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.SpB">[docs]</a>    <span class="k">def</span> <span class="nf">SpB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return the number of spikes in a burst. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">w_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w_max</span> <span class="o">=</span> <span class="n">w_max</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">w_max</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_properties</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
            <span class="n">w_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;w_max&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
                <span class="n">w_max</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">w_max</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">w_min</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Null/negative `w_max` and/or `w_min`.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">w_max</span> <span class="o">-</span> <span class="n">w_min</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">))</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.burst_duration"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.burst_duration">[docs]</a>    <span class="k">def</span> <span class="nf">burst_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return the duration of a burst. &#39;&#39;&#39;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_properties</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;ISI&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;SpB&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Null or negative `ISI` or `SpB` &lt;= 1.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;ISI&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;SpB&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dim</span></div>

    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Self-coherent equations (right-hand sides)</span>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.rhs_sce_alpha"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.rhs_sce_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">rhs_sce_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Right-hand side of the self-coherent equation for w in the alpha model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">w</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span>
        <span class="n">cst2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w_min</span><span class="p">):</span>
                <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="n">w_min</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w_tmp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w_tmp</span><span class="p">,</span> <span class="n">w_min</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="n">w_min</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
        <span class="c1"># test</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w_tmp</span>
        <span class="n">Vd</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="c1"># between d and d+4\tau_s</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="mf">4.</span>
        <span class="n">V_int</span> <span class="o">=</span>  <span class="n">Vd</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">+</span> <span class="n">I</span> <span class="o">-</span><span class="n">Vd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">-</span> <span class="n">w_tmp</span><span class="p">)</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">lambertw</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">shift</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">DT</span><span class="p">,</span> <span class="n">Vth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;V_th&quot;</span><span class="p">]</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="n">cst</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">LW</span> <span class="o">+</span> <span class="n">cst2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rhs</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">rhs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.rhs_sce_dirac"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.rhs_sce_dirac">[docs]</a>    <span class="k">def</span> <span class="nf">rhs_sce_dirac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Right-hand side of the self-coherent equation for w in the alpha model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">w</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Vr</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w_min</span><span class="p">):</span>
                <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="n">w_min</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w_tmp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w_tmp</span><span class="p">,</span> <span class="n">w_min</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="n">w_min</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">lambertw</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">-</span><span class="n">w_tmp</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="n">cst</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Qs</span> <span class="o">+</span> <span class="n">LW</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rhs</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">rhs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.rhs_sce_continuous"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.rhs_sce_continuous">[docs]</a>    <span class="k">def</span> <span class="nf">rhs_sce_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Right-hand side of the self-coherent equation for w in the alpha model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">))</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w_min</span><span class="p">):</span>
                <span class="n">w_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="n">w_min</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w_tmp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">w_tmp</span><span class="p">,</span> <span class="n">w_min</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="n">w_min</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">I_plus</span> <span class="o">=</span> <span class="n">w_tmp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w_min</span>
        <span class="n">avg_isi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_ISI</span><span class="p">(</span><span class="n">w_tmp</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">I_plus</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="n">w_min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">avg_isi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Qs</span>
        <span class="k">return</span> <span class="n">rhs</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">rhs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span></div>

    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Interpike intervals</span>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.interspike_dirac"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.interspike_dirac">[docs]</a>    <span class="k">def</span> <span class="nf">interspike_dirac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Compute the spike time for the Dirac synapse. &#39;&#39;&#39;</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
        <span class="c1"># between 0 and d</span>
        <span class="n">Vd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_lin_alpha_psp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="c1"># after d</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">ww</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vp</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Vd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Qs</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">G</span><span class="o">+</span><span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">G</span><span class="o">-</span><span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))</span><span class="o">/</span><span class="n">A</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative ISI for Dirac model.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">time</span>
        <span class="k">return</span> <span class="n">time</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.interspike_continuous"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.interspike_continuous">[docs]</a>    <span class="k">def</span> <span class="nf">interspike_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Compute the spike time for the continuous synapse. &#39;&#39;&#39;</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
        <span class="n">II</span> <span class="o">=</span> <span class="n">I</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span>
            <span class="n">_plib</span><span class="o">.</span><span class="n">invDerivV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vp</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">,</span> <span class="n">II</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative ISI for continuous model.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">time</span>
        <span class="k">return</span> <span class="n">time</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.interspike_continuous_approx"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.interspike_continuous_approx">[docs]</a>    <span class="k">def</span> <span class="nf">interspike_continuous_approx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Approximate spike time for the continuous synapse. &#39;&#39;&#39;</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
        <span class="n">II</span> <span class="o">=</span> <span class="n">I</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="n">II</span> <span class="o">-</span> <span class="n">ww</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vp</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vr</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="o">-</span><span class="n">II</span><span class="o">+</span><span class="n">ww</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ww</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="o">-</span><span class="n">II</span><span class="p">)</span> <span class="p">))</span> <span class="o">+</span>\
               <span class="mf">1.</span><span class="o">/</span><span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative ISI for continuous approximation.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">time</span>
        <span class="k">return</span> <span class="n">time</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.interspike_alpha"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.interspike_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">interspike_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute the spike time for the simplified (squared) alpha synapse.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w : double</span>
<span class="sd">            Value of the adaptation variable (should be in pA if `adim` is</span>
<span class="sd">            ``False``, otherwise dimensionless).</span>
<span class="sd">        delay : double, optional (default: None)</span>
<span class="sd">            Custom transmission delay, otherwise default to the value of the</span>
<span class="sd">            &quot;delay&quot; parameter entered on itialization.</span>
<span class="sd">        adim : bool, optional (default: False)</span>
<span class="sd">            Whether the returned result should be dimensionless or not.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">delay</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">delay</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="c1"># between 0 and d</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">ww</span>
        <span class="n">Vd</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dd</span><span class="p">)</span>
        <span class="c1"># between d and d+4\tau_s</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="mf">4.</span>
        <span class="n">V_int</span> <span class="o">=</span>  <span class="n">Vd</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">+</span> <span class="n">I</span> <span class="o">-</span> <span class="n">Vd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">-</span> <span class="n">ww</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="c1"># divergence time</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">ww</span> <span class="o">-</span> <span class="n">V_int</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vp</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">V_int</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="n">V_int</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">+</span><span class="n">A</span><span class="p">))))</span><span class="o">/</span><span class="n">A</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">A</span><span class="o">-</span><span class="n">V_int</span><span class="p">)</span><span class="o">/</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span>\
                   <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">+</span><span class="n">A</span><span class="p">)))</span><span class="o">/</span><span class="n">A</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative ISI for alpha model.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">time</span>
        <span class="k">return</span> <span class="n">time</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.avg_ISI"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.avg_ISI">[docs]</a>    <span class="k">def</span> <span class="nf">avg_ISI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Average inter-spike interval during the burst.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w_max : double</span>
<span class="sd">            Maximum value of the adaptation variable.</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Synaptic model.</span>
<span class="sd">        I  : double, optional (default: None)</span>
<span class="sd">            Value of the input current</span>
<span class="sd">            (required for the continuous model only).</span>
<span class="sd">        adim : bool, optional (default: False)</span>
<span class="sd">            Whether the result should be dimensionned or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        avg_ISI : double</span>
<span class="sd">            Average interspike interval.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">w_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computed</span><span class="p">:</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
                <span class="k">return</span> <span class="n">dim</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="s2">&quot;IBI&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#~ wmax = w_max - self.b</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w_min</span>
        <span class="n">avg_ISI</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">num_spikes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># necessary for continuous</span>
        <span class="k">while</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">w_max</span><span class="p">:</span>
            <span class="n">avg_ISI</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISI</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">approx</span><span class="p">,</span> <span class="n">adim</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
            <span class="n">num_spikes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">avg_ISI</span> <span class="o">=</span> <span class="n">avg_ISI</span> <span class="o">/</span> <span class="n">num_spikes</span> <span class="k">if</span> <span class="n">num_spikes</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">return</span> <span class="n">avg_ISI</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.T_first_spike"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.T_first_spike">[docs]</a>    <span class="k">def</span> <span class="nf">T_first_spike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V_init</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">V_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_init</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
        <span class="n">wmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wmin0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span>
        <span class="n">w_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">wmin</span> <span class="o">+</span> <span class="n">wmin0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w_avg</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vp</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">T_fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">V_init</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="n">w_avg</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_avg</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)))</span>\
               <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">A</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))</span> <span class="o">/</span> <span class="n">A</span>
        <span class="k">if</span> <span class="n">T_fs</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative time for first spike initiation&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T_fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="k">if</span> <span class="n">T_fs</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">T_fs</span>
        <span class="k">return</span> <span class="n">T_fs</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">T_fs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Various functions</span>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_unstab"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_unstab">[docs]</a>    <span class="k">def</span> <span class="nf">V_unstab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.w_down"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.w_down">[docs]</a>    <span class="k">def</span> <span class="nf">w_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_init</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Vmin0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_min0</span><span class="p">(</span><span class="n">w_max</span><span class="p">)</span>
        <span class="n">dotw0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">Vmin0</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Vr</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span><span class="o">-</span><span class="n">w_max</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span>
        <span class="k">return</span> <span class="n">w_max</span><span class="o">+</span><span class="n">dotw0</span><span class="o">*</span><span class="n">t</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="p">(</span><span class="n">w_max</span><span class="o">+</span><span class="n">dotw0</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.w_recover_lin"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.w_recover_lin">[docs]</a>    <span class="k">def</span> <span class="nf">w_recover_lin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the value of w during the recovery period as a function of the</span>
<span class="sd">        potential.</span>
<span class="sd">        This value is obtained as the limit where $\dot{w} = -\dot{V}$ and</span>
<span class="sd">        follows:</span>
<span class="sd">        </span>
<span class="sd">        $$w = \frac{1}{1+\tau_w} \left[ (a-\tau_w)(V-E_L)+\tau_w I_e \right]$$</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;V_th&quot;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_param</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">]</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="p">)</span><span class="o">*</span><span class="n">dim</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_recover_lin"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_recover_lin">[docs]</a>    <span class="k">def</span> <span class="nf">V_recover_lin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">w_init</span><span class="p">,</span> <span class="n">w_min</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the value of V during the beginning of the recovery period as a</span>
<span class="sd">        function of the potential.</span>
<span class="sd">        This value is obtained as the limit where $\dot{w} = -\dot{V}$ and</span>
<span class="sd">        follows:</span>

<span class="sd">        $$w = \frac{1}{1+\tau_w} \left[ (a-\tau_w)(V-E_L)+\tau_w I_e \right]$$</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_min</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">V_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">w_init</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V_min</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">w_init</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">w_min</span> <span class="o">-</span> <span class="n">w_init</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">V</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">V</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_min0"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_min0">[docs]</a>    <span class="k">def</span> <span class="nf">V_min0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wmax</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Dimensionless minimum for V at zeroth order &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">wmax</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.T_down"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.T_down">[docs]</a>    <span class="k">def</span> <span class="nf">T_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">V_final</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_end_burst</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">V_init</span> <span class="ow">is</span> <span class="kc">None</span>
                  <span class="k">else</span> <span class="n">V_init</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">V_min0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_min0</span><span class="p">(</span><span class="n">w_max</span><span class="p">)</span>
        <span class="n">T_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">*</span><span class="p">(</span><span class="n">V_final</span> <span class="o">+</span> <span class="n">V_min0</span><span class="p">)</span> <span class="o">/</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">+</span><span class="n">V_final</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">w_max</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">T_down</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">T_down</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.w_recover_start"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.w_recover_start">[docs]</a>    <span class="k">def</span> <span class="nf">w_recover_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">t_tmp</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">t_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">)</span>
            <span class="n">V_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_down</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_down</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_tmp</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">w</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_recover_start"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_recover_start">[docs]</a>    <span class="k">def</span> <span class="nf">V_recover_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">t_tmp</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">t_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">)</span>
            <span class="n">V_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_down</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">w_down</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_tmp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="o">+</span> <span class="n">ratio</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_tmp</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">V</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">V</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_end_burst"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_end_burst">[docs]</a>    <span class="k">def</span> <span class="nf">V_end_burst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">V_final</span><span class="p">,</span> <span class="n">t_final</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;dirac&quot;</span><span class="p">:</span>
            <span class="n">V_final</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vr</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="o">+</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span>\
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Qs</span>
            <span class="n">t_final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span>
            <span class="c1"># get the maximum of V_lin_alpha if it&#39;s less than 3 delays,</span>
            <span class="c1"># otherwize the last value will be a good approximation anyway.</span>
            <span class="n">ts</span><span class="p">,</span> <span class="n">Vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func_V_spike</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">3.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">idx_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">Vs</span><span class="p">)</span>
                <span class="n">V_final</span><span class="p">,</span> <span class="n">t_final</span> <span class="o">=</span> <span class="n">Vs</span><span class="p">[</span><span class="n">idx_max</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="n">idx_max</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
                   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                   <span class="n">V_final</span><span class="p">,</span> <span class="n">t_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">V_final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span>
        <span class="k">if</span> <span class="n">return_time</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">V_final</span><span class="p">,</span> <span class="n">t_final</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">V_final</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">,</span> <span class="n">t_final</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">V_final</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">V_final</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.T_start_recover"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.T_start_recover">[docs]</a>    <span class="k">def</span> <span class="nf">T_start_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Time necessary to reach $w_{r, L}(V_{min})$ &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">V_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_down</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">V_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span>
        <span class="n">w_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_recover_lin</span><span class="p">(</span><span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">w_down</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">w_target</span><span class="o">-</span><span class="n">B</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative time for beginning of recovery.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">T</span>
        <span class="k">return</span> <span class="n">T</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">T</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span></div>

<div class="viewcode-block" id="Fardet2017_SynchroBurst.V_lin_alpha_psp"><a class="viewcode-back" href="../../../modules/models.html#pyneuractiv.models.Fardet2017_SynchroBurst.V_lin_alpha_psp">[docs]</a>    <span class="k">def</span> <span class="nf">V_lin_alpha_psp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the potential between two spikes in the burst.</span>
<span class="sd">        This function uses a local time which is zero at spike time.</span>

<span class="sd">        warning:</span>
<span class="sd">            This function is not supposed to be used with arrays! (except by</span>
<span class="sd">            _func_V_spike).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">Vs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">t</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">frac_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w</span>
        <span class="n">Dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interspike_alpha</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">:</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">-</span> <span class="n">shift</span> <span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
            <span class="n">psp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">*</span><span class="n">frac_ts</span><span class="o">*</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Dt</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">frac_ts</span><span class="o">-</span><span class="n">Dt</span><span class="p">)</span> <span class="o">+</span>\
                                  <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">Dt</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Dt</span><span class="o">+</span><span class="n">t</span><span class="o">-</span><span class="n">frac_ts</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">Vs</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">decay</span> <span class="o">+</span> <span class="n">psp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="k">else</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">t1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;Times must be either all smaller or all &#39;</span> <span class="o">+</span>\
                                 <span class="s1">&#39;larger than the delay.&#39;</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
            <span class="n">Vd</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">-</span> <span class="n">shift</span> <span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">*</span><span class="n">frac_ts</span><span class="o">*</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Dt</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">frac_ts</span><span class="o">-</span><span class="n">Dt</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">+</span><span class="n">Dt</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Dt</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">-</span><span class="n">frac_ts</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Vd</span> <span class="o">-</span> <span class="n">shift</span> <span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tt</span><span class="p">)</span>
            <span class="n">Dt1</span> <span class="o">=</span> <span class="n">Dt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="n">psp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">*</span><span class="n">frac_ts</span><span class="o">*</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Dt1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">-</span><span class="n">tt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">frac_ts</span><span class="o">-</span><span class="n">Dt1</span><span class="p">)</span> <span class="o">+</span>\
                <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">tt</span><span class="o">+</span><span class="n">Dt1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Dt1</span><span class="o">+</span><span class="n">tt</span><span class="o">-</span><span class="n">frac_ts</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">psp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I0</span><span class="o">*</span><span class="n">frac_ts</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tt</span><span class="p">)</span><span class="o">*</span><span class="n">frac_ts</span> <span class="o">+</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tt</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tt</span><span class="o">-</span><span class="n">frac_ts</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">Vs</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">decay</span> <span class="o">+</span> <span class="n">psp1</span> <span class="o">+</span> <span class="n">psp2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>  <span class="c1"># changed the reference if t is a numpy array</span>
            <span class="n">t</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="k">return</span> <span class="n">Vs</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">Vs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span></div>

    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Detailed functions</span>

    <span class="k">def</span> <span class="nf">_func_V_spike</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
                     <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return the potential between two spikes in the burst. &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISI</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># generate the times and check whether the delay is included inside</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">idx_d</span> <span class="o">=</span> <span class="n">find_idx_nearest</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx_d</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>  <span class="c1"># to make sure idx_d+1 works and is after d</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_lin_alpha_psp</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
            <span class="n">idx_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">idx_d</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">idx_d</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">pre_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_lin_alpha_psp</span><span class="p">(</span><span class="n">ts</span><span class="p">[:</span><span class="n">idx_lim</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="n">post_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_lin_alpha_psp</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">idx_lim</span><span class="p">:],</span> <span class="n">w</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pre_d</span><span class="p">,</span> <span class="n">post_d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_func_Vdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function giving the potential between `start` and `stop` (by default, 0</span>
<span class="sd">        and T_min)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w_max : double</span>
<span class="sd">            Maximum value of w_max at the end of the burst.</span>
<span class="sd">        V_max : double</span>
<span class="sd">            Maximum value of the potential after the last spike of the burst.</span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of values ot interpolate the function.</span>
<span class="sd">        start : double, optional (default: 0.)</span>
<span class="sd">            Starting time (by default, its is the end of the burst, defined as</span>
<span class="sd">            zero time)</span>
<span class="sd">        stop : double, optional (default: None)</span>
<span class="sd">            End time, if None, defaults to `T_down`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts, Vs : tuple of numpy arrays for the times and potentials.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">V_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">start</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">Vmin0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_min0</span><span class="p">(</span><span class="n">w_max</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w_max</span>
        <span class="n">dotw0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">Vmin0</span> <span class="o">+</span> <span class="n">V_max</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span> <span class="o">-</span> <span class="n">w_max</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tw</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">V_max</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">dotw0</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">Vs</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">start</span><span class="o">-</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">dotw0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">start</span><span class="o">-</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">Vs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="o">*</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span><span class="o">*</span><span class="n">Vs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span>

    <span class="k">def</span> <span class="nf">_func_wdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function giving w between `start` and `stop`, which are defined by</span>
<span class="sd">        default as 0. and $T_{min}$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w_max : double</span>
<span class="sd">            Maximum value of w_max at the end of the burst.</span>
<span class="sd">        V_max : double</span>
<span class="sd">            Maximum value of the potential after the last spike of the burst.</span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of values ot interpolate the function.</span>
<span class="sd">        start : double</span>
<span class="sd">            Starting time.</span>
<span class="sd">        stop : double, optional (default: None)</span>
<span class="sd">            End time, if None, defaults to T_down</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts, ws : tuple of numpy arrays for the times and values of w</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">V_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">start</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">)</span>
        <span class="n">Vmin0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_min0</span><span class="p">(</span><span class="n">w_max</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">-</span> <span class="n">w_max</span>
        <span class="n">dotw0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">Vmin0</span> <span class="o">+</span> <span class="n">V_max</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span><span class="p">)</span> <span class="o">-</span> <span class="n">w_max</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tw</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">V_max</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">dotw0</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
              <span class="k">else</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">w_max</span> <span class="o">+</span> <span class="n">dotw0</span><span class="o">*</span><span class="p">(</span><span class="n">ts</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ws</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="o">*</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="o">*</span><span class="n">ws</span>

    <span class="k">def</span> <span class="nf">_func_w_recover_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Dynamics of w during the early phase of the recovery period, just after</span>
<span class="sd">        the decrease of V.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_down</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">V_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
        <span class="n">V_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_start_recover</span><span class="p">(</span><span class="n">V_min</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_recover_start</span><span class="p">(</span><span class="n">ts</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ws</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ts</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">,</span> <span class="n">ws</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>

    <span class="k">def</span> <span class="nf">_func_V_recover_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ts_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">-</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">V_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_recover_start</span><span class="p">(</span><span class="n">ts_tmp</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">V_min</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="n">adim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_func_w_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_init</span><span class="p">,</span> <span class="n">V_init</span><span class="p">,</span> <span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function giving w between `start` and `stop` (by default, T_min and</span>
<span class="sd">        T_I) during the recovery period -- after the sharp decrease of V.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w_init : double</span>
<span class="sd">            Maximum value of w_max at the end of the burst.</span>
<span class="sd">        V_init : double</span>
<span class="sd">            Maximum value of the potential after the last spike of the burst.</span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of values ot interpolate the function.</span>
<span class="sd">        start : double, optional (default: 0.)</span>
<span class="sd">            Starting time (by default, its is the end of the burst, defined as</span>
<span class="sd">            zero time)</span>
<span class="sd">        stop : double, optional (default: None)</span>
<span class="sd">            End time, if None, defaults to T_down</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts, ws : tuple of numpy arrays for the times and values of w</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_init</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">V_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_init</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">V_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
            <span class="n">w_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
        <span class="n">V_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">w_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ie</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tw</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">T_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_down</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">V_init</span><span class="o">=</span><span class="n">V_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">T_start_recov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_start_recover</span><span class="p">(</span><span class="n">V_min</span><span class="p">,</span> <span class="n">w_down</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">T_down</span> <span class="o">+</span> <span class="n">T_start_recov</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">IBI</span><span class="p">(</span><span class="n">w_max</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="n">T_down</span> <span class="o">-</span> <span class="n">T_start_recov</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">cst</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_init</span> <span class="o">-</span> <span class="n">cst</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ts</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ws</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="o">*</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="o">*</span><span class="n">ws</span>

    <span class="k">def</span> <span class="nf">_func_V_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">V_init</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function giving V during the recovery period -- after the sharp</span>
<span class="sd">        decrease of V to $V_-$ -- as a function of w.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ws : :obj:`list`</span>
<span class="sd">            List of the values of w during this period.</span>
<span class="sd">        V_init : double</span>
<span class="sd">            Value of V at the beginning of the recovery (after</span>
<span class="sd">            the initial post-burst decrease and nullcline crossing).</span>
<span class="sd">        adim : bool, optional (default: True)</span>
<span class="sd">            Whether the input and results are dimensionless.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vs : :class:`numpy.array`</span>
<span class="sd">            V values (one for each value in `ws`).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">)</span>
            <span class="n">V_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_init</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span>
        <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ws</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">))</span>
        <span class="n">w_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_minus</span><span class="p">(</span><span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_recover_lin</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ws</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w_min</span><span class="p">,</span> <span class="n">V_init</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Vs</span><span class="p">[</span><span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">return</span> <span class="n">Vs</span> <span class="k">if</span> <span class="n">adim</span> <span class="k">else</span> <span class="n">Vs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">DT_dim</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vt_dim</span>

    <span class="k">def</span> <span class="nf">_func_w_burst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_min</span><span class="p">,</span> <span class="n">t_init</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
                     <span class="n">homogeneous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function giving the behaviour of w during the burst.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w_min : double</span>
<span class="sd">            Initial value of w at the beginning of the burst.</span>
<span class="sd">        t_init : double</span>
<span class="sd">            Time at which the first spike of the burst occurs.</span>
<span class="sd">        steps : int</span>
<span class="sd">            Number of points to interpolate the function.</span>
<span class="sd">        model : :obj:`str`, optional (default: &quot;alpha&quot;)</span>
<span class="sd">            Model used for the PSPs (&quot;dirac&quot;, &quot;continuous&quot;, or &quot;alpha&quot;).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts, ws : :class:`numpy.array`s</span>
<span class="sd">            Times and values of w during the burst.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">adim</span><span class="p">:</span>
            <span class="n">w_min</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimW</span>
            <span class="n">t_init</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">ISI</span> <span class="o">=</span> <span class="n">w_min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mf">0.</span>
        <span class="c1"># initialize spike and w lists</span>
        <span class="n">spike_times</span><span class="p">,</span> <span class="n">lst_w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="n">ts</span><span class="p">,</span> <span class="n">ws</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        <span class="c1"># compute the critical value of w and the number of spikes</span>
        <span class="n">w_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">homogeneous</span><span class="o">=</span><span class="n">homogeneous</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">w_star</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NaN value for w_star&quot;</span><span class="p">)</span>
        <span class="n">SpB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SpB</span><span class="p">(</span><span class="n">w_star</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># compute the spike times and w_max</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SpB</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">w_star</span><span class="p">)</span>
            <span class="n">I</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">model</span> <span class="o">!=</span> <span class="s2">&quot;continuous&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">+</span> <span class="n">w_star</span> <span class="o">-</span> <span class="n">w_min</span>
            <span class="n">ISI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ISI</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">adim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">spike_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spike_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ISI</span><span class="p">)</span>
            <span class="n">lst_w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="c1"># deduce the duration of the burst</span>
        <span class="n">T_B</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Make the the w values</span>
        <span class="n">lst_w</span> <span class="o">=</span> <span class="n">lst_w</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">T_B</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">steps</span><span class="o">/</span><span class="n">T_B</span><span class="p">,</span>
                                      <span class="n">spike_times</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t_init</span><span class="p">,</span> <span class="n">T_B</span><span class="o">+</span><span class="n">t_init</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">homogeneous</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">indices</span><span class="p">:</span>
                   <span class="n">idx_start</span><span class="p">,</span> <span class="n">idx_stop</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="mi">0</span>
                   <span class="n">w_val</span> <span class="o">=</span> <span class="n">lst_w</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                   <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">idx_stop</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">ws</span><span class="p">[</span><span class="n">idx_start</span><span class="p">:</span><span class="n">idx_stop</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_val</span>
                   <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">idx_start</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                           <span class="n">ws</span><span class="p">[</span><span class="n">idx_start</span><span class="p">:]</span> <span class="o">=</span> <span class="n">w_val</span>
                        <span class="k">else</span><span class="p">:</span>
                           <span class="n">ws</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ws</span> <span class="o">=</span> <span class="n">w_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">ts</span> <span class="o">-</span> <span class="n">t_init</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w_star</span> <span class="o">-</span> <span class="n">w_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_init</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="n">steps</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
            <span class="n">ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">w_min</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
            <span class="n">ws</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">if</span> <span class="n">adim</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">spike_times</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="k">return</span> <span class="p">(</span><span class="n">ts</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">,</span> <span class="n">ws</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimW</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimT</span><span class="p">))</span>

    <span class="c1">#--------------------------------------------------------------------------</span>
    <span class="c1"># Init tools</span>

    <span class="k">def</span> <span class="nf">_generate_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Store the values from a ``dict`` of dimensionless values. &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EL</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;E_L&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ie</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;I_e&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;tau_syn_ex&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tw</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;tau_w&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vr</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;V_reset&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vp</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;V_peak&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gL</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;g_L&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DT</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Delta_T&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;avg_deg&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;delay&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Imax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Imax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Imax</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>